{% extends "layout.html" %}
{% block title %}PMT noise{% endblock %}
{% block head %}
    {{ super() }}
{% endblock %}
{% block body %}
{{ super() }}


<div class="container">
    <div id="noise-chart"></div>
    <div id="hhp-chart"></div>
<!--<img src="{{ url_for('static', filename='pmtnoise/noise-rate_time-series.png') }}" class="img-responsive" alt="Noise time-series">
    <img src="{{ url_for('static', filename='pmtnoise/qhl-hhp_time-series.png') }}" class="img-responsive" alt="HHP time-series">--!>

    <table class="table table-hover">
      <thead>
      <tr>
        <th>Run Number</th>
        <th>Run Time</th>
        <th>Average noise (Hz)</th>
	<th>Average QHL HHP (cap)</th>
	<th>NHit (raw)</th>
	<th>NHit (normal/HQE 50Hz-50kHz)</th>
	<th>NHit (normal/HQE N20/N100 enabled)</th>
	<th>PGT Count</th>
	<th>Online PMTs</th>
      </tr>
    </thead>
    <tbody>
      {% for run in runs if run %}
      {% if "n_pgt" in run and run["n_pgt"]|int() > 10000 %}
      <tr class="info">
      {% else %}
      <tr>
      {% endif %}
	<td><a href="{{ url_for('noise_run_detail',run_number = run['run_number']) }}">{{ run["run_number"] }}</a></td>
	<td>{{ run["run_time"]|timefmt }}</td>
	<td>{{ "%.0f" % (run["average_noiserate"]|float) }}</td>
	{% if "average_qhl_hhp" in run %}
	<td>{{ "%.1f" % (run["average_qhl_hhp"]|float) }}</td>
	{% else %}
	<td>{{ "-" }}</td>
	{% endif %}
	{% if "average_nhit_raw" in run %}
	<td>{{ "%.1f" % (run["average_nhit_raw"]|float) }}</td>
	{% else %}
	<td>{{ "-" }}</td>
	{% endif %}
	{% if "average_nhit_normal" in run %}
        <td>{{ "%.1f" % (run["average_nhit_normal"]|float) }}</td>
        {% else %}
        <td>{{ "-" }}</td>
        {% endif %}
	{% if "average_nhit_trigenabled" in run %}
        <td>{{ "%.1f" % (run["average_nhit_trigenabled"]|float) }}</td>
        {% else %}
        <td>{{ "-" }}</td>
        {% endif %}
	{% if "n_pgt" in run %}
	<td>{{ "%.0f" % (run["n_pgt"]|float) }}</td>
	{% else %}
	<td>{{ "-" }}</td>
	{% endif %}
	{% if "online_pmt" in run %}
	<td>{{ "%.0f" % (run["online_pmt"]|float) }}</td>
	{% else %}
	<td>{{ "-" }}</td>
	{% endif %}
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>

{% endblock %}

{% block script %}
<!--
    <script src="{{ url_for('static', filename='js/d3.js') }}"></script>
    <script>
        var svg = d3.select('svg'), 
            margin = {top:20, bottom:20, right:20, left: 50}, 
            width = +svg.attr("width") - margin.left - margin.right,
            height = +svg.attr("height") - margin.top - margin.bottom,
            g = svg.append("g").attr("transform", "translate(" + margin.left + "," + margin.top + ")");

    var xify = d3.scaleLinear().rangeRound([0,width])
    var yify = d3.scaleLinear().rangeRound([height,0])
    var lineify = d3.line().x(function (d) {return xify(d.x);})
                           .y(function (d) {return yify(d.y);});
    </script>
--!>
<!--
    <script src="https://code.highcharts.com/highcharts.js"></script>
    <script src="https://code.highcharts.com/modules/series-label.js"></script>
    <script src="https://code.highcharts.com/modules/exporting.js"></script>
    <script src="https://code.highcharts.com/modules/export-data.js"></script>
--!>
    <script src="static/highcharts/highcharts.js"></script>
    <script src="static/js/dynamic_plot.js"></script>
    <script>
        // for each crate, build a time-series by iterating over each run
        noiseseries = [{% for i in range(19) %} 
                    {
                        name: 'Crate {{ i }}', 
                        data: [{% for run in runs|reverse %} 
                                   {% if run and run['average_noise_crate'][i]%} 
                                       [{{ run['run_number'] }}, 
                                        {{ run['average_noise_crate'][i] }}],
                                   {% endif %}
                               {% endfor %}] 
                    },
                {% endfor %}];
        mkDynamicPlot('noise-chart', 
                      'Per-Crate Noise Rates', 'Run Number', 'Noise Rate [Hz]', 
                      noiseseries, 0, 2500);
        // for each crate, build a time-series by iterating over each run
        gainseries = [{% for i in range(19) %} 
                    {
                        name: 'Crate {{ i }}', 
                        data: [{% for run in runs|reverse %} 
                                   {% if run and run['average_qhl_hhp_crate'][i]%} 
                                       [{{ run['run_number'] }}, 
                                        {{ run['average_qhl_hhp_crate'][i] }}],
                                   {% endif %}
                               {% endfor %}] 
                    },
                {% endfor %}];
        mkDynamicPlot('hhp-chart', 
                      'Per-Crate Gains', 'Run Number', 'QHS HHP [cap]',
                      gainseries, 0, 150);
    </script>

{% endblock %}
